//Copyright>    CFG Files and Library ("CFG")
//Copyright>    Copyright (C) 1986-2026 Altair Engineering Inc.
//Copyright>
//Copyright>    Altair Engineering Inc. grants to third parties limited permission to
//Copyright>    use and modify CFG solely in connection with OpenRadioss software, provided
//Copyright>    that any modification to CFG by a third party must be provided back to
//Copyright>    Altair Engineering Inc. and shall be deemed a Contribution under and therefore
//Copyright>    subject to the CONTRIBUTOR LICENSE AGREEMENT for OpenRadioss software.
//Copyright>
//Copyright>    CFG IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
//Copyright>    INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR
//Copyright>    A PARTICULAR PURPOSE, AND NONINFRINGEMENT.  IN NO EVENT SHALL ALTAIR ENGINEERING
//Copyright>    INC. OR ITS AFFILIATES BE LIABLE FOR ANY CLAIM, DAMAGES, OR OTHER LIABILITY,
//Copyright>    WHETHER IN AN ACTION OF CONTRACT, TORT, OR OTHERWISE, ARISING FROM, OUT OF, OR
//Copyright>    IN CONNECTION WITH CFG OR THE USE OR OTHER DEALINGS IN CFG.
//
// *PARAMETER 
//

ATTRIBUTES(COMMON)
{
    count                 = SIZE("Parameter count");
    name_a                = ARRAY[count](STRING, "Parameter name"); 
    type_a                = ARRAY[count](UINT, "Parameter Type");//TYPE_DOUBLE(0),TYPE_INTEGER, TYPE_STRING,TYPE_DOUBLE_EXPRESSION(10),TYPE_INTEGER_EXPRESSION
    value_a               = ARRAY[count](STRING, "Temp Value String");
    valueint_a            = ARRAY[count](INT, "Int Value");
    valuedouble_a         = ARRAY[count](DOUBLE, "Double Value");
    valuestring_a         = ARRAY[count](STRING, "String Value");
    p_type                = VALUE(STRING, "");

    //after split new preobject
    name               = VALUE(STRING, "Parameter name"); 
    type               = VALUE(UINT, "Parameter Type");//TYPE_DOUBLE(0),TYPE_INTEGER, TYPE_STRING,TYPE_DOUBLE_EXPRESSION(10),TYPE_INTEGER_EXPRESSION
    valueint           = VALUE(INT, "Int Value");
    valuedouble        = VALUE(DOUBLE, "Double Value");
    valuestring        = VALUE(STRING, "String Value");
    PARAM_SCOPE        = VALUE(STRING, "Parameter Scope");

    c_indx             = VALUE(UINT, "");
    col                = VALUE(UINT, "");
    localoption        = VALUE(INT, "");
}

SKEYWORDS_IDENTIFIER(COMMON)
{
    count              = -1;
    name_a             = -1;
    type_a             = -1;
    value_a            = -1;
    valueint_a         = -1;
    valuedouble_a      = -1;
    valuestring_a      = -1;
    p_type             = -1;
    c_indx             = -1;
    col                = -1;
    localoption        = -1;
}

DEFINITIONS(COMMON)
{
  _SPLIT_ARRAY_TO_SINGLE = (count);
}

DRAWABLES(COMMON)
{
     _PARAM_NAME         = SCALAR(name);
     _PARAM_SCOPE        = SCALAR(PARAM_SCOPE);
     _PARAM_VALUE_DOUBLE = SCALAR(valuedouble);
     _PARAM_VALUE_INT    = SCALAR(valueint);
     _PARAM_VALUE_STRING = SCALAR(valuestring);
     _PARAM_TYPE         = SCALAR(type);
}

GUI(COMMON)
{
    RADIO(type)
    {
        ADD(0, "Double");
        ADD(1, "Integer");
        ADD(2, "String");
    }
    if(type == 0)
    {
       SCALAR(valuedouble);
    }
    else if(type == 1)
    {
       SCALAR(valueint);
    }
    else if(type == 2)
    {
       SCALAR(valuestring);
    }
}

// File format
FORMAT(Keyword971) 
{
    ASSIGN(_IOMODE_, 1, IMPORT);
    ASSIGN(_IOMODE_, 0, EXPORT);
    if(PARAM_SCOPE == "LOCAL") ASSIGN(localoption, 1, EXPORT);
    else                       ASSIGN(localoption, 0, EXPORT);
    HEADER("*PARAMETER%s", APPEND_OPTIONS( [localoption(1), "_LOCAL"] ));
    if(_IOMODE_ == 1)
    {
       if(localoption == 1) ASSIGN(PARAM_SCOPE, "LOCAL");
       else                 ASSIGN(PARAM_SCOPE, "GLOBAL");

       FREE_CELL_LIST(count,"%10s%10s",name_a, value_a );

       ASSIGN(c_indx, 0, IMPORT);
       ASSIGN(col,    1, IMPORT);
       CARD_LIST(count)
       {
          ASSIGN(p_type,      _ATTRIB(name_a, c_indx, col ));
          if(p_type=="I")
          {
            ASSIGN(type_a, 1);
            ASSIGN(name_a, _ERASE(name_a, "I"));
            ASSIGN(valueint_a, _STOI(value_a));
          }
          else if(p_type=="R")
          {
            ASSIGN(type_a, 0);
            ASSIGN(name_a, _ERASE(name_a, "R"));
            ASSIGN(valuedouble_a, _STOF(value_a));
          }
          else if(p_type=="C")
          {
            ASSIGN(type_a, 2);
            ASSIGN(name_a, _ERASE(name_a, "C"));
            ASSIGN(valuestring_a, value_a);
          }
          ASSIGN(c_indx,    c_indx+1, IMPORT);
       }
    }
    else
    {
        CARD("%1s%-9s%10lf",APPEND_OPTIONS( [type({1,0,2}), {"I","R","C"}] ), name, CELL_COND(if (type == 1)     valueint; 
                                                                                              else if(type == 0) valuedouble;
                                                                                              else if(type == 2) valuestring;) );

    }
}
